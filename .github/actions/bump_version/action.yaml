name: Bump the release version

runs:
  using: "composite"
  steps:
    - name: Get latest tag
      id: get_latest_tag
      run: |
        TAG=$(git describe --tags --abbrev=0 || echo "v0.0.0")
        echo "Latest tag: $TAG"
        echo "tag=$TAG" >> $GITHUB_OUTPUT

    - name: Parse next version
      id: bump_version
      run: |
        TITLE="${{ github.event.pull_request.title }}"
        CURRENT_TAG="${{ steps.get_latest_tag.outputs.tag }}"
        VERSION="${CURRENT_TAG#v}"
        if [[ $TITLE == *major* ]]; then
          cd .github/actions/bump_version
          ./version.sh major
          echo "NEW_VERSION=$NEW_VERSION" >> $GITHUB_OUTPUT
        elif [[ $TITLE == *minor* ]]; then
          cd .github/actions/bump_version
          ./version.sh minor
          echo "NEW_VERSION=$NEW_VERSION" >> $GITHUB_OUTPUT
        else
          cd .github/actions/bump_version
          ./version.sh
          echo "NEW_VERSION=$NEW_VERSION" >> $GITHUB_OUTPUT
          
    - name: Create and push new tag
      run: |
        git config user.name "github-actions"
        git config user.email "github-actions@github.com"
        git tag ${{ steps.bump_version.outputs.NEW_VERSION }}
        git push origin ${{ steps.bump_version.outputs.NEW_VERSION }}
        